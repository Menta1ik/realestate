// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Project {
  id            String   @id @default(uuid())
  ref           String   @unique
  nameEn        String
  nameRu        String
  developer     String
  status        String   // 'Off-plan' | 'Ready'
  type          String   // 'apartment' | 'villa' ...
  handoverEn    String
  handoverRu    String
  priceFromAED  Int
  paymentPlanEn String?
  paymentPlanRu String?
  descriptionEn String
  descriptionRu String
  
  // Specs
  bedrooms      String   // "1, 2, 3"
  bathrooms     String?
  size          String   // "780 - 2400 sq.ft"
  
  // Arrays (Simulated via relations or separate tables for SQLite)
  photos        Photo[]
  amenities     Amenity[]
  tags          Tag[]
  unitTypes     UnitType[]
  documents     Document[]

  // Relations
  areaId        String
  area          Area     @relation(fields: [areaId], references: [id])
  
  developerId   String?
  developerRel  Developer? @relation(fields: [developerId], references: [id])

  leads         Lead[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Property {
  id            String   @id @default(uuid())
  ref           String   @unique
  nameEn        String
  nameRu        String
  developer     String
  status        String   // 'Off-plan' | 'Ready'
  type          String   // 'apartment' | 'villa' ...
  handoverEn    String
  handoverRu    String
  priceFromAED  Int
  paymentPlanEn String?
  paymentPlanRu String?
  descriptionEn String
  descriptionRu String
  
  // Specs
  bedrooms      String   // "1, 2, 3"
  bathrooms     String?
  size          String   // "780 - 2400 sq.ft"
  
  // Arrays
  photos        Photo[]
  amenities     Amenity[]
  tags          Tag[]
  unitTypes     UnitType[]
  documents     Document[]

  // Relations
  areaId        String
  area          Area     @relation(fields: [areaId], references: [id])
  
  developerId   String?
  developerRel  Developer? @relation(fields: [developerId], references: [id])
  
  leads         Lead[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Developer {
  id          String   @id @default(uuid())
  name        String   // Keep for fallback/internal use
  nameEn      String   @default("")
  nameRu      String   @default("")
  slug        String   @unique
  year        Int?
  office      String?
  descriptionEn String?
  descriptionRu String?
  
  projects    Project[]
  properties  Property[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Photo {
  id        String  @id @default(uuid())
  url       String
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  propertyId String?
  property  Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Amenity {
  id        String  @id @default(uuid())
  code      String  // 'pool', 'gym'
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  propertyId String?
  property  Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Tag {
  id        String  @id @default(uuid())
  name      String
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  propertyId String?
  property  Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model TagCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  nameEn    String?
  nameRu    String?
  color     String?  // hex code or css var
  bgColor   String?  // background color for soft ui
  icon      String?  // Icon name
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UnitType {
  id           String  @id @default(uuid())
  kind         String  // '1BR', 'Studio'
  priceFromAED Int
  sizeFromSqFt Int?
  // New fields
  pricePerSqFt Int?
  image        String? // Floor plan image
  
  projectId    String?
  project      Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  propertyId   String?
  property     Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Document {
  id        String  @id @default(uuid())
  labelEn   String
  labelRu   String
  type      String  // 'brochure', 'floorplan'
  url       String
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  propertyId String?
  property  Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Area {
  id        String    @id @default(uuid())
  slug      String    @unique
  nameEn    String
  nameRu    String
  
  // Content
  propertyTypeEn String?
  propertyTypeRu String?
  
  featuresEn    String[]
  featuresRu    String[]
  
  locationEn    String?
  locationRu    String?
  
  schoolsEn     Json?
  schoolsRu     Json?
  
  descriptionEn String?
  descriptionRu String?
  
  developer     String?
  
  avgPricesEn   Json?
  avgPricesRu   Json?
  
  nearbyAreasEn String[]
  nearbyAreasRu String[]
  
  // Legacy/Simple fields
  teaserEn  String?
  teaserRu  String?
  priceFromAED Int?
  roi       String?
  
  projects  Project[]
  properties Property[]
}

model Lead {
  id        String   @id @default(uuid())
  name      String?
  phone     String
  type      String   // 'whatsapp', 'form'
  message   String?
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id])
  propertyId String?
  property  Property? @relation(fields: [propertyId], references: [id])
  createdAt DateTime @default(now())
}

// Universal Feature/Amenity Catalog
model Feature {
  id        String   @id @default(uuid())
  nameEn    String
  nameRu    String
  icon      String   // Lucide icon name
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LayoutType {
  id          String   @id @default(uuid())
  code        String   @unique // '1BR', 'Studio'
  nameEn      String
  nameRu      String
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
